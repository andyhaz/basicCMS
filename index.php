<?php######################### Basic CMS index page# Version 1.2.0# By Andy Hazlett# Copyright 2006# Under GPL 2.0######################configinclude ("config/db_config.php");#include ("mods/functions.php");#recive mouse click$link = $_GET['link'];$sub_link = $_GET['sublink'];$show_link = $_GET['show'];$com = $_GET['code'];#set_def errorif($link){}else{$link = "0";$sub_link = "0";}#end error check#set def pageif($show_link){} else {$query = "select user_id from webpage where def_id='$link' order by def_id;";$result = @mysql_query($query); 	if($result){	$n = 0;		while($row = mysql_fetch_array($result,MYSQL_NUM)){			$q[$n] = $row[0];			$n ++;		}#end while*/	}#end if reulet		$show_link = $q[0];}#end show_link#functionfunction get_content($show_link){	$query = "select page_id from webpage where user_id='$show_link';";	$result = @mysql_query($query); 	if($result){		while($row = mysql_fetch_array($result,MYSQL_NUM)){			$c = $row[0];		}#end while*/	} else {		$c = "error in database";	}#end if else error check	return $c;}#end get_contentfunction get_menu(){	$num = 0;#get main title	$query = "select def_id,title_id,def_id,sub_id,lock_id,user_id from webpage order by def_id;";	$result = @mysql_query($query); 	if($result){		while($row = mysql_fetch_array($result,MYSQL_NUM)){			$pas = explode(":",$row[1]);			if($pas[0] == "title"){				$m .= "<a href=\"index.php?link=$pas[2]&show=$pas[5]\">$pas[1]</a> ";			} else {			 if( $row[3] <= 0 && $row[4] == 0){					$m .= "<a href=\"index.php?link=$row[0]&show=$row[5]\">$row[1]</a> ";				}#end if 			}		}#end while*/	} else {		$m = "error in database";	}#end if else error check	return $m;}#end get menufunction get_sub_menu($sub_where){	$num = 0;#get sub title	$query = "select def_id,def_id,sub_id,title_id,lock_id,user_id from webpage where def_id='$sub_where' order by sub_id;";	$result = @mysql_query($query); 	if($result){		while($row = mysql_fetch_array($result,MYSQL_NUM)){			$pas = explode(":",$row[1]);			if($pas[0] == "title"){				$m .= "<a href=\"index.php?link=$pas[1]&sub_link=$pas[2]&show=$pas[5]\">$pas[3]</a> ";			} else {				if($row[2] >= 1 && $row[4] == 0){					$m .= "<a href=\"index.php?link=$row[1]&sub_link=$row[2]&show=$row[5]\">$row[3]</a> ";				}			}		}#end while*/	} else {		$m = "error in database";	}#end if else error check	return $m;}#end sub menu$css = "<link href=\"css/def.css\" rel=\"stylesheet\" type=\"text/css\">";$menu = get_menu();$sub_menu = get_sub_menu($link);#event managerswitch($link){	case 'action':		$pash = explode(",",$com);		switch($pash[0]){			case'url':				header("location:http://$pash[1]");			break;			case'massage':				$body = $pash[1];			break;			default:				$body = "error";			}#end swich 	break;	default:		$body = get_content($show_link);}#end switchmysql_close();include_once("templat.php");?>