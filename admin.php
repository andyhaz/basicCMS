<?php######################### Basic CMS# Version 1.2.0 admin panle# By Andy Hazlett# Copyright 2006# Under GPL 2.0######################config$usr = "admin";$pass = "admin";$image_path = "images/";$doc_path = "docs/basiccms.txt";$css_path = "css/";#do not edit blow this lineinclude ("config/db_config.php");$version = "Version 1.2.0 Admin Panle";#display what verstion$table_massage = " there are no pages Yet";$error_massage = "101 error";$doc_name = "page-form.html";$mode = "admin.php?action=insertpage";#def page setting#get data from froms and server	$action = $_GET['action'];	$myfile = $_GET['filename'];	$where = $_GET['where'];	$title = $_POST['pagetitle'];	$oder = $_POST['odr'];	$sub_odr = $_POST['sub_odr'];	$page_lock = $_POST['pagelock'];	$page_content = $_POST['content'];#funtion Callsfunction insert_web_page($title,$oder,$sub_odr,$page_content,$page_lock){	$query = "insert into webpage(title_id,def_id,sub_id,lock_id,page_id,data_id) values('$title', '$oder','$sub_odr','$page_lock','$page_content',now());";	$result = @mysql_query($query);		if($result){		header("location:http:admin.php");	} else {		$f = "error";	}#end test for error		return $f;}#end inser_web_pagefunction update($title,$oder,$sub_odr,$page_content,$page_lock,$where){	if($page_lock == "checkbox"){		$lp = '1';	} else {		$lp = '0';	}#end set up page lock	$query = "update webpage set def_id='$oder',sub_id='$sub_odr',title_id='$title',lock_id='$lp',page_id='$page_content' where user_id='$where';";	$result = @mysql_query($query);	if($result){		header("location:http:admin.php");	} else {		$back = "error on update";	}#end if/else reslit	return $back;}#end updatefunction del_web_page($where){	$query = "delete from webpage where user_id='$where';";	$result = @mysql_query($query);	if($result){		header("location:http:admin.php");	} else {		$f = "error";	}#end see if error	return $f;}#end del_web_pagefunction show_main_table($massage){	$query = "select def_id,sub_id,title_id,user_id,lock_id from webpage order by def_id;";	$result = @mysql_query($query);	$s .="<table width=\"600\" border=\"0\" cellspacing=\"2\" cellpadding=\"0\">";	$s .= "<tr><td>Page Oder</td><td>Sub Page</td><td>&nbsp;</td><td>Title(menu name)</td><td></td></td><td></td></td><td>page lock</td></tr>"; 	if($result){		while($row = mysql_fetch_array($result,MYSQL_NUM)){		$lock = $row[4];		if($row[4] == 0){		 	$lock = "Off";		 } else {		 	$lock = "On";		}#ewnd if else 		 $s .= "<tr><td>$row[0]</td><td>$row[1]</td><td></td><td>$row[2]</td><td><a href=\"admin.php?action=editpage&where=$row[3]\">Edit</a></td><td><a href=\"admin.php?action=delpage&where=$row[3]\">Delete</a></td></td><td>$lock</td></tr>";		}#end while	} else {		$s = $massage;	}#end if else error check $s .= "</table>"; return $s;}#end show_main_tablefunction show_from($mode,$where){	$pull = 10;	#$lp = "checked";	if($mode == "update"){		$query = "select title_id,sub_title_id,def_id,sub_id,lock_id,page_id from webpage where user_id='$where';";		$result = @mysql_query($query); 		if($result){			while($row = mysql_fetch_array($result,MYSQL_NUM)){				$title = $row[0];				$sub_title = $row[1];				$def_num = $row[2];				$sub_num = $row[3];				$page_lock = $row[4];				$content = $row[5];			}#end while		$action_from = "admin.php?action=update&where=$where";		} else {			$s = $massage;		}#end if else error check	} else {		$action_from = "admin.php?action=insertpage";#def page setting	}#end mode test#make pull down and place number in the right place			$m .= "<select name=\"odr\">";			for($i = 0; $i <= $pull; $i++){				if($def_num == $i){   				 $m .= "<option selected>$i</option>";    			} else {				 $m .= "<option>$i</option>";				}#end test for p			}#end for loop pull			$m .= "</select>";			#end main menu			$s = "<select name=\"sub_odr\">";			for($i = 0; $i <= $pull; $i++){				if($sub_num == $i){   				 $s .= "<option selected>$i</option>";    			} else {				 $s .= "<option>$i</option>";				}#end test for p			}#end for loop pull			$s .= "</select>";			#end sub menu#end#setup page lock	if($page_lock == "1"){		$lp = 'checked';	} else {		$lp = ' ';	}#end set up page lock#end page lock	#note mode is ad or edit	$f .= "<form name=\"form1\" method=\"post\" action=\"$action_from\">";	$f .= "<table width=\"341\" height=\"254\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr>";    $f .= "<td><div align=\"center\">Page Title<br>type (title:mbl:action&code=url,www.website.com/)<br><input name=\"pagetitle\" type=\"text\" value=\"$title\"></div></td>";    $f .= "</tr><tr><td><div align=\"center\">";    $f .= "main menu".$m."<br>";	$f .= "sub menu".$s."<br>";	$f .= "Lock This Page<input type=\"checkbox\" name=\"pagelock\" id=\"pagelock\" value=\"checkbox\"$lp><br>";    $f .= "page number 0 will be default page</div></td></tr><tr><td><div align=\"center\">Page Content (can add HTML Code)<br>";    $f .= "<textarea name=\"content\" cols=\"50\" rows=\"20\">$content</textarea>";    $f .= "</div></td></tr><tr><td><div align=\"center\"><input type=\"submit\" name=\"Submit\" value=\"Done\"></div></td></tr>";	$f .= "</table></form>";	return $f;}#end show_fromfunction login($usr,$pass){	$usrlog = $_SERVER['PHP_AUTH_USER'];	$usrpass = $_SERVER['PHP_AUTH_PW'];	$authorized = false;	if (!isset($usrlog) && !isset($uerpass)) {			header('WWW-Authenticate: Basic realm="admin"');			header('HTTP/1.0 401 Unauthorized');			exit;	} else {		if($usr == $usrlog && $pass == $usrpass){			$authorized = true;			header("location:admin.php?action=home");		} else {			header('WWW-Authenticate: Basic realm="admin"');			header('HTTP/1.0 401 Unauthorized');		}#end if	}}#end loginfunction upload($image_path){	 $file = $_FILES['upload_file'];	if ($file) {		$file_name = $_FILES['upload_file']['name'];		$file_size = $_FILES['upload_file']['size'];	if (move_uploaded_file($_FILES['upload_file']['tmp_name'],$image_path.$file_name)) {			#header("location:http:admin.php?action=media");			$f = $file_name;		} else {			$f .= "Possible file upload attack! Here's some debugging info:\n $_FILES".$image_path.$file_name;		} 	unlink ($file);	}	return $f;}//end uploadfunction delete_media($image_path,$myfile){	unlink ("$image_path".$myfile);	header("location:http:admin.php?action=media");}#end delete_mediafunction show_media($path){	if ($handle = opendir($path)) {		while (false !== ($file = readdir($handle))) {			if($file != "." && $file != "..") {				$fl .= "$file <a href=\"admin.php?action=delfile&filename=$file\">Delete File</a><br>";				}//end if		}//end while	closedir($handle);	}//end if  handler 		return $fl;}#end show_mediafunction upload_from($ac){	$f .= "<table width=\"765\" height=\"168\" border=\"0\"><tr>";    $f .= "<td width=\"206\" height=\"81\" align=\"center\" valign=\"top\">Upload Image";    $f .= "<form action=\"admin.php?action=$ac\" method=\"POST\" enctype=\"multipart/form-data\">";  	$f .= "File:<input type=\"FILE\" name=\"upload_file\" size=\"20\"><br>";    $f .= "<input type=\"SUBMIT\" name=\"SUBMIT2\" value=\"Submit!\"></form>";    $f .= "$fl </td></tr></table>";		return $f;}#end upload_fromfunction load_doc($doc_path){	$filename = "$doc_path";//load document	$file_pointer = fopen ($filename,"r");	$data = file($filename);	for($i=0;$i < count($data);$i++){		$get_line = explode("\n",$data[$i]);		$data[$i];		$f .= "$get_line[0]";		}//end for loop	fclose ($file_pointer);	return $f;}#end load_docfunction rename_css($path,$file){	rename($path.$file,$path."def.css");}#end rename_css#event managerswitch($action){	case "home":		$body = show_main_table($table_massage);	break;	case "addpage":		$body = show_from($mode,$where);	break;	case "insertpage":		$body = insert_web_page($title,$oder,$sub_odr,$page_content,$page_lock);	break;	case "update":		$body = update($title,$oder,$sub_odr,$page_content,$page_lock,$where);	break;	case "editpage":		$mode = "update";		$body = show_from($mode,$where);	break;	case "delpage":		$body = del_web_page($where);	break;	case 'media':		$up = upload_from("upload");		$body = show_media($image_path)."<br>".$up;	break;	case 'delfile':		$body = delete_media($image_path,$myfile);	break;	case 'upload':		$body = upload($image_path);		header("location:http:admin.php?action=media");	break;	case 'css':		$body = upload_from("uploadcss");	break;	case 'uploadcss':		$f = upload($css_path);		$body = rename_css($css_path,$f);		header("location:http:admin.php?action=css");	break;	case 'support':		$body =  load_doc($doc_path);	break;	default:		login($usr,$pass);}#end switch event manger  	mysql_close();#load template?><html><head><title>BasicCMS Admin</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><style type="text/css"><!--body {	font-family: Arial, Helvetica, sans-serif;	font-size: 12px;	padding-left: 150px;	padding-top: 50px;}<!--p.body {	width: 450px;	border-top: 1px solid #000066;	border-right: 3px solid #CCCCCC;	border-bottom: 2px solid #CCCCCC;	border-left: 1px solid #000066;}table {	border: thin none #3300CC;	width: 450px;	font-size: 12px;	text-align: center;}a:link {color: #999999; text-decoration: none}a:visited {color: #999999; text-decoration: none}a:hover  {	color: #FFFFFF;	background-color: #0066CC;} --></style></head><body><p><img src="images/basicCMSlogo.jpg" width="334" height="84"><br><?php echo($version); ?></p><p><a href="admin.php?action=home">Home</a> |<a href="admin.php?action=css"> Style</a> | <a href="admin.php?action=addpage">New    page</a> | <a href="admin.php?action=media"> Media</a> | <a href="admin.php?action=support">Support</a> |    <a href="index.php" target="_blank">Preview</a></p><table width="100%" border="0" cellpadding="0" cellspacing="0">  <tr>    <td>   	 <p class="body"><?php echo($body) ?></p></td>  </tr></table><p>CopyRight <a href="http://www.magicboxlabs.com" target="_blank">MagicBoxlabs</a>,LLC 2006</p></body></html>